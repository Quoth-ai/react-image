{"version":3,"file":"useImage-e6398fb2.js","sources":["../jsSrc/imagePromiseFactory.js","../jsSrc/useImage.js"],"sourcesContent":["// returns a Promisized version of Image() api\nexport default ({ decode = true, crossOrigin = '' }) => (src) => {\n    return new Promise((resolve, reject) => {\n        const i = new Image();\n        if (crossOrigin)\n            i.crossOrigin = crossOrigin;\n        i.onload = () => {\n            decode && i.decode ? i.decode().then(resolve).catch(reject) : resolve();\n        };\n        i.onerror = reject;\n        i.src = src;\n    });\n};\n//# sourceMappingURL=imagePromiseFactory.js.map","import { useState } from 'react';\nimport imagePromiseFactory from './imagePromiseFactory';\nconst removeBlankArrayElements = (a) => a.filter((x) => x);\nconst stringToArray = (x) => (Array.isArray(x) ? x : [x]);\nconst cache = {};\n// sequential map.find for promises\nconst promiseFind = (arr, promiseFactory) => {\n    let done = false;\n    return new Promise((resolve, reject) => {\n        const queueNext = (src) => {\n            return promiseFactory(src).then(() => {\n                done = true;\n                resolve(src);\n            });\n        };\n        arr\n            .reduce((p, src) => {\n            // ensure we aren't done before enquing the next source\n            return p.catch(() => {\n                if (!done)\n                    return queueNext(src);\n            });\n        }, queueNext(arr.shift()))\n            .catch(reject);\n    });\n};\nexport default function useImage({ srcList, imgPromise = imagePromiseFactory({ decode: true }), useSuspense = true, }) {\n    const [, setIsLoading] = useState(true);\n    const sourceList = removeBlankArrayElements(stringToArray(srcList));\n    const sourceKey = sourceList.join('');\n    if (!cache[sourceKey]) {\n        // create promise to loop through sources and try to load one\n        cache[sourceKey] = {\n            promise: promiseFind(sourceList, imgPromise),\n            cache: 'pending',\n            error: null,\n        };\n    }\n    // when promise resolves/reject, update cache & state\n    cache[sourceKey].promise\n        // if a source was found, update cache\n        // when not using suspense, update state to force a rerender\n        .then((src) => {\n        cache[sourceKey] = { ...cache[sourceKey], cache: 'resolved', src };\n        if (!useSuspense)\n            setIsLoading(false);\n    })\n        // if no source was found, or if another error occured, update cache\n        // when not using suspense, update state to force a rerender\n        .catch((error) => {\n        cache[sourceKey] = { ...cache[sourceKey], cache: 'rejected', error };\n        if (!useSuspense)\n            setIsLoading(false);\n    });\n    if (cache[sourceKey].cache === 'resolved') {\n        return { src: cache[sourceKey].src, isLoading: false, error: null };\n    }\n    if (cache[sourceKey].cache === 'rejected') {\n        if (useSuspense)\n            throw cache[sourceKey].error;\n        return { isLoading: false, error: cache[sourceKey].error, src: undefined };\n    }\n    // cache[sourceKey].cache === 'pending')\n    if (useSuspense)\n        throw cache[sourceKey].promise;\n    return { isLoading: true, src: undefined, error: null };\n}\n//# sourceMappingURL=useImage.js.map"],"names":["decode","crossOrigin","src","Promise","resolve","reject","i","Image","onload","then","onerror","removeBlankArrayElements","a","filter","x","stringToArray","Array","isArray","cache","promiseFind","arr","promiseFactory","done","queueNext","reduce","p","shift","useImage","srcList","imgPromise","imagePromiseFactory","useSuspense","useState","setIsLoading","sourceList","sourceKey","join","promise","error","isLoading","undefined"],"mappings":"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"}