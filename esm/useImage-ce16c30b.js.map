{"version":3,"file":"useImage-ce16c30b.js","sources":["../jsSrc/imagePromiseFactory.js","../jsSrc/useImage.js"],"sourcesContent":["// returns a Promisized version of Image() api\nexport default ({ decode = true, crossOrigin = '', loadTimeout }) => (src, isLastSrc) => {\n    return new Promise((resolve, reject) => {\n        const i = new Image();\n        let timer;\n        if (crossOrigin)\n            i.crossOrigin = crossOrigin;\n        i.onload = () => {\n            clearTimeout(timer);\n            decode && i.decode ? i.decode().then(resolve).catch(reject) : resolve();\n        };\n        i.onerror = reject;\n        i.src = src;\n        if (loadTimeout && !isLastSrc) {\n            timer = setTimeout(() => {\n                i.src = '';\n                reject();\n            }, loadTimeout);\n        }\n    });\n};\n//# sourceMappingURL=imagePromiseFactory.js.map","import { useState } from 'react';\nimport imagePromiseFactory from './imagePromiseFactory';\nconst removeBlankArrayElements = (a) => a.filter((x) => x);\nconst stringToArray = (x) => (Array.isArray(x) ? x : [x]);\nconst cache = {};\n// sequential map.find for promises\nconst promiseFind = (arr, promiseFactory) => {\n    const srcLength = arr.length;\n    let done = false;\n    return new Promise((resolve, reject) => {\n        const queueNext = (src, isLastSrc) => {\n            return promiseFactory(src, isLastSrc).then(() => {\n                done = true;\n                resolve(src);\n            });\n        };\n        arr\n            .reduce((p, src, index) => {\n            // ensure we aren't done before enquing the next source\n            return p.catch(() => {\n                // index + 1 because we start operation from second item of array \n                const isLasutSrc = index + 1 === srcLength - 1;\n                if (!done)\n                    return queueNext(src, isLasutSrc);\n            });\n        }, queueNext(arr.shift(), srcLength === 1))\n            .catch(reject);\n    });\n};\nexport default function useImage({ srcList, imgPromise, useSuspense = true, loadTimeout }) {\n    const imgLoadPromise = imgPromise ?? imagePromiseFactory({ decode: true, loadTimeout });\n    const [, setIsLoading] = useState(true);\n    const sourceList = removeBlankArrayElements(stringToArray(srcList));\n    const sourceKey = sourceList.join('');\n    if (!cache[sourceKey]) {\n        // create promise to loop through sources and try to load one\n        cache[sourceKey] = {\n            promise: promiseFind(sourceList, imgLoadPromise),\n            cache: 'pending',\n            error: null,\n        };\n    }\n    // when promise resolves/reject, update cache & state\n    cache[sourceKey].promise\n        // if a source was found, update cache\n        // when not using suspense, update state to force a rerender\n        .then((src) => {\n        cache[sourceKey] = { ...cache[sourceKey], cache: 'resolved', src };\n        if (!useSuspense)\n            setIsLoading(false);\n    })\n        // if no source was found, or if another error occured, update cache\n        // when not using suspense, update state to force a rerender\n        .catch((error) => {\n        cache[sourceKey] = { ...cache[sourceKey], cache: 'rejected', error };\n        if (!useSuspense)\n            setIsLoading(false);\n    });\n    if (cache[sourceKey].cache === 'resolved') {\n        return { src: cache[sourceKey].src, isLoading: false, error: null };\n    }\n    if (cache[sourceKey].cache === 'rejected') {\n        if (useSuspense)\n            throw cache[sourceKey].error;\n        return { isLoading: false, error: cache[sourceKey].error, src: undefined };\n    }\n    // cache[sourceKey].cache === 'pending')\n    if (useSuspense)\n        throw cache[sourceKey].promise;\n    return { isLoading: true, src: undefined, error: null };\n}\n//# sourceMappingURL=useImage.js.map"],"names":["decode","crossOrigin","loadTimeout","src","isLastSrc","Promise","resolve","reject","i","Image","timer","onload","clearTimeout","then","onerror","setTimeout","removeBlankArrayElements","a","filter","x","stringToArray","Array","isArray","cache","promiseFind","arr","promiseFactory","srcLength","length","done","queueNext","reduce","p","index","isLasutSrc","shift","useImage","srcList","imgPromise","useSuspense","imgLoadPromise","imagePromiseFactory","useState","setIsLoading","sourceList","sourceKey","join","promise","error","isLoading","undefined"],"mappings":"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"}